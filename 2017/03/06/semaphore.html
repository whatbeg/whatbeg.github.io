
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>用信号量解决进程的同步与互斥探讨 | Whatbeg&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="whatbeg">
    

    
    <meta name="description" content="本篇也是一篇老文，发布于2015年5月，文章比较长，算老博客看的比较多的了，贴到这儿与大家分享，以求多多交流探讨。
前言现代操作系统采用多道程序设计机制，多个进程可以并发执行，CPU在进程之间来回切换，共享某些资源，提高了资源的利用率，但这也使得处理并发执行的多个进程之间的冲突和相互制约关系成为了一道难题。如果对并发进程的调度不当，则可能会出现运行结果与切换时间有关的情况，令结果不可再现，影响系统">
<meta property="og:type" content="article">
<meta property="og:title" content="用信号量解决进程的同步与互斥探讨">
<meta property="og:url" content="http://whatbeg.com/2017/03/06/semaphore.html">
<meta property="og:site_name" content="Whatbeg's blog">
<meta property="og:description" content="本篇也是一篇老文，发布于2015年5月，文章比较长，算老博客看的比较多的了，贴到这儿与大家分享，以求多多交流探讨。
前言现代操作系统采用多道程序设计机制，多个进程可以并发执行，CPU在进程之间来回切换，共享某些资源，提高了资源的利用率，但这也使得处理并发执行的多个进程之间的冲突和相互制约关系成为了一道难题。如果对并发进程的调度不当，则可能会出现运行结果与切换时间有关的情况，令结果不可再现，影响系统">
<meta property="og:image" content="http://images.cnitblog.com/blog2015/591194/201504/301954238803051.jpg">
<meta property="og:image" content="http://images.cnitblog.com/blog2015/591194/201504/302312154437620.jpg">
<meta property="og:image" content="http://images.cnitblog.com/blog2015/591194/201505/010058320368735.jpg">
<meta property="og:image" content="http://images0.cnblogs.com/blog2015/591194/201505/241529590481971.png">
<meta property="og:updated_time" content="2017-03-06T11:48:09.838Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="用信号量解决进程的同步与互斥探讨">
<meta name="twitter:description" content="本篇也是一篇老文，发布于2015年5月，文章比较长，算老博客看的比较多的了，贴到这儿与大家分享，以求多多交流探讨。
前言现代操作系统采用多道程序设计机制，多个进程可以并发执行，CPU在进程之间来回切换，共享某些资源，提高了资源的利用率，但这也使得处理并发执行的多个进程之间的冲突和相互制约关系成为了一道难题。如果对并发进程的调度不当，则可能会出现运行结果与切换时间有关的情况，令结果不可再现，影响系统">
<meta name="twitter:image" content="http://images.cnitblog.com/blog2015/591194/201504/301954238803051.jpg">

    
    <link rel="alternative" href="/atom.xml" title="Whatbeg&#39;s blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/w.ico">
    
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Whatbeg&#39;s blog">Whatbeg&#39;s blog</a></h1>
				<h2 class="blog-motto">当你的才华撑不起你的野心时，就应该静下心来好好学习。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页(Home)</a></li>
					
						<li><a href="/archives">归档(Archives)</a></li>
					
						<li><a href="/tags">标签(Tags)</a></li>
					
						<li><a href="/categories">分类(Categories)</a></li>
					
						<li><a href="/about">关于(About)</a></li>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2017/03/06/semaphore.html" title="用信号量解决进程的同步与互斥探讨" itemprop="url">用信号量解决进程的同步与互斥探讨</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="whatbeg" target="_blank" itemprop="author">whatbeg</a>
		
  <p class="article-time">
    <time datetime="2017-03-06T11:41:49.000Z" itemprop="datePublished"> 发表于 2017-03-06</time>
    <span id="busuanzi_container_page_pv">
    总阅读<span id="busuanzi_value_page_pv"></span>次
    </span>
  </p>

</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#概念"><span class="toc-number">2.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#经典问题"><span class="toc-number">3.</span> <span class="toc-text">经典问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#问题1：生产者-消费者问题"><span class="toc-number">3.1.</span> <span class="toc-text">问题1：生产者-消费者问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题2：读者-写者问题"><span class="toc-number">3.2.</span> <span class="toc-text">问题2：读者-写者问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题3：哲学家就餐问题"><span class="toc-number">3.3.</span> <span class="toc-text">问题3：哲学家就餐问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#例子分析"><span class="toc-number">4.</span> <span class="toc-text">例子分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#问题4：放水果问题"><span class="toc-number">4.1.</span> <span class="toc-text">问题4：放水果问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题5：读文件问题"><span class="toc-number">4.2.</span> <span class="toc-text">问题5：读文件问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题6：阅览室问题-图书馆问题"><span class="toc-number">4.3.</span> <span class="toc-text">问题6：阅览室问题 / 图书馆问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题7：单行道问题"><span class="toc-number">4.4.</span> <span class="toc-text">问题7：单行道问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题8：理发师问题"><span class="toc-number">4.5.</span> <span class="toc-text">问题8：理发师问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献"><span class="toc-number">5.</span> <span class="toc-text">参考文献</span></a></li></ol>
		
		</div>
		
		<p>本篇也是一篇老文，发布于2015年5月，文章比较长，算老博客看的比较多的了，贴到这儿与大家分享，以求多多交流探讨。</p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>现代操作系统采用多道程序设计机制，多个进程可以并发执行，CPU在进程之间来回切换，共享某些资源，提高了资源的利用率，但这也使得处理并发执行的多个进程之间的冲突和相互制约关系成为了一道难题。如果对并发进程的调度不当，则可能会出现运行结果与切换时间有关的情况，令结果不可再现，影响系统的效率和正确性，严重时还会使系统直接崩溃。就比如你只有一台打印机，有两个进程都需要打印文件，如果直接让他们简单地并发访问打印机，那么你很可能什么都打印不出来或者打印的文件是…anyway，我们需要增加一些机制来控制并发进程间的这种相互制约关系。</p>
<blockquote>
<p><strong>进程间通信的很多问题的根本原因是我们不知道进程何时切换。</strong></p>
</blockquote>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>首先我们了解一下临界资源与临界区的概念：临界资源就是一次只允许一个进程访问的资源，一个进程在使用临界资源的时候，另一个进程是无法访问的，操作系统也不能够中途剥夺正在使用者的使用权利，正所谓“泼出去的女儿嫁出去的水”是也。即临界资源是不可剥夺性资源。那么临界区呢？所谓临界区就是进程中范文临界资源的那段程序代码，注意，是程序代码，不是内存资源了，这就是临界资源与临界区的区别。我们规定临界区的使用原则（也即同步机制应遵循的准则）十六字诀：“空闲让进，忙则等待，有限等待，让权等待”–strling。让我们分别来解释一下：</p>
<p>（1）空闲让进：临界资源空闲时一定要让进程进入，不发生“互斥礼让”行为。<br>（2）忙则等待：临界资源正在使用时外面的进程等待。<br>（3）有限等待：进程等待进入临界区的时间是有限的，不会发生“饿死”的情况。<br>（4）让权等待：进程等待进入临界区是应该放弃CPU的使用。</p>
<p>好了，我们进入下一部分。</p>
<p>进程间通常存在着两种制约关系：直接制约关系和间接制约关系，就是我们通常所说的进程的同步与互斥。顾名思义，一个是合作关系，一个是互斥关系。进程互斥说白了就是“你用的时候别人都不能用，别人用的时候，你也不能去用”，是一种源于资源共享的间接制约关系。进程同步指的是“我们大家利用一些共同的资源区，大家一起合作，完成某些事情，但是我在干某些小事的时候，可能要等到你做完另一些小事”，是一种源于相互合作的直接制约关系。两者区别在于互斥的进程间没有必然的联系，属于竞争者关系，谁竞争到资源（的使用权），谁就使用它，直到使用完才归还。就比如洗衣房的洗衣机这个资源，去洗衣的同学并不需要有必然联系，你们可以互不认识，但是谁竞争到洗衣机的使用权，就可以使用，直到洗完走人。而同步的进程间是有必然联系的，即使竞争到使用权，如果合作者没有发出必要的信息，该进程依然不能执行。就比如排队打水，即使排到你了，如果水箱没水了，你就打不了水，说明你和水箱是有着必然联系的，你得从它里面取水，你们是同步关系，你们合作完成“打水”这个过程。</p>
<p>那么先来讨论如何实现进程的互斥控制。有下列几种方法：严格轮换（每个进程每次都从头执行到尾，效率不高，可能等待很久），屏蔽中断（刚刚进入临界区时就屏蔽中断，刚要出临界区就打开中断），专用机器指令test_and_set,test_and_clear，加锁，软件方法，信号量机制。讲一下加锁和软件方法，加锁方法如下：设置一个锁标志K表示临界资源的状态，K=1表示临界资源正在被使用，K=0表示没有进程在访问临界资源。如果一个进程需要访问临界资源，那么先检查锁标志K：<br><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">K</span> == <span class="number">1</span>, 循环检测，直到<span class="keyword">K</span> = <span class="number">0</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">K</span> == <span class="number">0</span>，设置锁标志为<span class="number">1</span>，进入临界区</span><br></pre></td></tr></table></figure></p>
<p>离开临界区时设置锁标志K为0. 软件方法类似，如爱斯基摩人的小屋协议，爱斯基摩人的小屋很小，每次只能容纳一个人进入，小屋内有一个黑板，上面标志这能够进入临界区的进程。若进程申请进入临界区，则先进入小屋检查黑板标志，如果是自己，那么离开小屋进入临界区，执行完后进入小屋修改黑板标志为其他进程，离开小屋。如果小屋黑板标志不是自己，那么反复进入小屋考察黑板标志是不是自己。这两种方法都实现了互斥访问，但是都违反了四条原则之一：让权等待，都需要不断的循环重复检测标志，霸占了CPU资源，不是很好的方法。</p>
<p>到后来，荷兰计算机科学家Dijkstra于1965年提出了解决进程同步与互斥问题的信号量机制，收到了很好的效果，被一直沿用至今，广泛应用与单处理机和多处理机系统以及计算机网络中。信号量机制就是说两个或者多个进程通过他们都可以利用的一个或多个信号来实现准确无误不冲突的并发执行。如果临界资源不够，就会有一个信号表示出来，如果进程此时想访问，那么就会阻塞到一个队列中，等待调度。当临界资源使用完毕，一个进程改变信号，并及时唤醒阻塞的进程，这就实现了进程间的同步和互斥问题。</p>
<p>信号量分为整型信号量，记录型信号量，AND信号量以及信号量集。最初的信号量就是整型信号量，定义信号量为一个整型变量，仅能通过两个原子操作P,V来访问，所谓原子操作就是指一组相联的操作要么不间断地执行，要么不执行。这两个操作又称为wait和signal操作或者down和up操作。之所以叫P,V操作是因为Dijkstra是荷兰人，P指的是荷兰语中的“proberen”，意为“测试”，而V指的是荷兰语中的“verhogen”，意为“增加”。最初P,V操作被描述为：<br><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">P(<span class="keyword">S</span>):   <span class="keyword">while</span> (<span class="keyword">S</span>≤<span class="number">0</span>)  &#123;<span class="keyword">do</span> nothing&#125;<span class="comment">;</span></span><br><span class="line">        <span class="keyword">S</span>=<span class="keyword">S</span>-<span class="number">1</span><span class="comment">;</span></span><br><span class="line">        </span><br><span class="line">V(<span class="keyword">S</span>):   <span class="keyword">S</span>=<span class="keyword">S</span>+<span class="number">1</span><span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>但是这样明显违反了“让权等待的原则”，后来发展为记录型信号量，记录型信号量的数据结构是一个两元组，包含信号量的值value和关于此信号量的阻塞队列Q，value具有非负初值，一般反映了资源的数量，只能由P,V操作改变其值。（还有另一种定义，信号量由value和P组成，value为信号量的值，P为指向PCB队列的指针）。</p>
<p>记录型信号量的P,V操作原语为：<br><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">P(<span class="keyword">S</span>):   <span class="keyword">S</span>.value = <span class="keyword">S</span>.value-<span class="number">1</span><span class="comment">;</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">S</span>.value &lt; <span class="number">0</span>)</span><br><span class="line">           block(<span class="keyword">S</span>,<span class="keyword">Q</span>)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">V(<span class="keyword">S</span>):   <span class="keyword">S</span>.value = <span class="keyword">S</span>.value + <span class="number">1</span><span class="comment">;</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">S</span>.value &lt;= <span class="number">0</span>)</span><br><span class="line">            wakeup(<span class="keyword">S</span>,<span class="keyword">Q</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure></p>
<p>我们来详细解释一下这两个操作的含义：</p>
<p>首先，P操作，首先将S.value减1，表示该进程需要一个临界资源，如果S.value<0，那么说明原来的s.value <="0，即已经没有资源可用了，于是将进程阻塞到与信号量S相关的阻塞队列中去，如果S.value<0,那么|S.value|其实就表示阻塞队列的长度，即等待使用资源的进程数量。然后，V操作：首先S.value加1，表示释放一个资源，如果S.value" 0，阻塞队列中是由进程的，于是唤醒该队列中的一个进程。那么，为什么s.value=""> 0时不唤醒进程呢，很简单，因为阻塞队列中没有进程了。</0，那么说明原来的s.value></p>
<p>P操作相当于“等待一个信号”，而V操作相当于“发送一个信号”，在实现同步过程中，V操作相当于发送一个信号说合作者已经完成了某项任务，在实现互斥过程中，V操作相当于发送一个信号说临界资源可用了。实际上，在实现互斥时，P,V操作相当于申请资源和释放资源。</p>
<p>我们将信号量初值设置为1时通常可实现互斥，因为信号量表示资源可用数目，互斥信号量保证只有一个进程访问临界资源，相当于只有一个访问权可用。设置为0或者N时可以用来实现同步。我们后面将会在生产者-消费者问题中看到这点。用P,V操作实现互斥类似于加锁的实现，在临界区之前加P操作，在临界区之后加V操作，即可互斥控制进程进入临界区，访问临界资源。记录型信号量由于引入了阻塞机制，消除了不让权等待的情况，提高了实现的效率。</p>
<h2 id="经典问题"><a href="#经典问题" class="headerlink" title="经典问题"></a>经典问题</h2><p>下面通过一些实例详细讲解如何使用信号量机制解决进程同步与互斥问题。先说明一条规律，即：同步与互斥实现的P,V操作虽然都是成对出现，但是互斥的P,V操作出现在同一个进程的程序里，而同步的P,V操作出现在不同进程的程序中。</p>
<h3 id="问题1：生产者-消费者问题"><a href="#问题1：生产者-消费者问题" class="headerlink" title="问题1：生产者-消费者问题"></a>问题1：生产者-消费者问题</h3><p>经典的同步互斥问题，也称作“有界缓冲区问题”。具体表现为：</p>
<p>1.两个进程对同一个内存资源进行操作，一个是生产者，一个是消费者。<br>2.生产者往共享内存资源填充数据，如果区域满，则等待消费者消费数据。<br>3.消费者从共享内存资源取数据，如果区域空，则等待生产者填充数据。<br>4.生产者的填充数据行为和消费者的消费数据行为不可在同一时间发生。</p>
<center> <img src="http://images.cnitblog.com/blog2015/591194/201504/301954238803051.jpg" alt=""> </center>

<p>生产者-消费者之间的同步关系表现为缓冲区空，则消费者需要等待生产者往里填充数据，缓冲区满则生产者需要等待消费者消费。两者共同完成数据的转移或传送。生产者-消费者之间的互斥关系表现为生产者往缓冲区里填充数据的时候，消费者无法进行消费，需要等待生产者完成工作，反之亦然。</p>
<p>既然了解了互斥与同步关系，那么我们就来设置信号量：</p>
<p>由于有互斥关系，所以我们应该设置一个互斥量mutex控制两者不能同时操作缓冲区。此外，为了控制同步关系，我们设置两个信号量empty和full来表示缓冲区的空槽数目和满槽数目，即有数据的缓冲区单元的个数。mutex初值为1，empty初值为n，即缓冲区容量，代表初始没有任何数据，有n个空的单元，类似的，full初值为0.</p>
<p>下面进行生产者-消费者行为设计：<br><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">void Productor() &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">//制造数据</span></span><br><span class="line">        P(&amp;empty)<span class="comment">;</span></span><br><span class="line">        P(&amp;mutex)<span class="comment">;</span></span><br><span class="line">        <span class="comment">//填充数据</span></span><br><span class="line">        V(&amp;mutex)<span class="comment">;</span></span><br><span class="line">        V(&amp;full)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Consumer() &#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        P(&amp;full)<span class="comment">;</span></span><br><span class="line">        P(&amp;mutex)<span class="comment">;</span></span><br><span class="line">        <span class="comment">//消费数据</span></span><br><span class="line">        V(&amp;mutex)<span class="comment">;</span></span><br><span class="line">        V(&amp;empty)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样我们的分析也就完成了，<a href="http://www.cnblogs.com/whatbeg/p/4419979.html" target="_blank" rel="external">http://www.cnblogs.com/whatbeg/p/4419979.html</a> 这篇文章里有我用Windows API实现的用信号量实现生产者-消费者问题。</p>
<p>下面，问题来了，我们的生产者和消费者里面都有两个P,两个V操作，那么两个P操作可否调换顺序呢？V操作呢？想一想。</p>
<p>答案是P操作不可对换，V操作可以。为什么呢？想象一下这种情况，生产者执行P(mutex)把互斥量锁住，然后再P(empty),此时empty &lt; 0，锁住，无法继续生产，等待消费者消费，消费者倒是也想消费，可是mutex被锁住了啊，于是两个人就等啊等，就成了等待戈多了。。但是V操作是可以随意调换的，因为V操作是解锁和唤醒，不会因为它锁住什么。</p>
<h3 id="问题2：读者-写者问题"><a href="#问题2：读者-写者问题" class="headerlink" title="问题2：读者-写者问题"></a>问题2：读者-写者问题</h3><p>第二个经典问题是读者-写着问题，它为数据库的访问建立了一个模型。规则如下：</p>
<p>1.一个进程在读的时候，其他进程也可以读。<br>2.一个进程在读/写的时候，其他进程不能进行写/读。<br>3.一个进程在写的时候，其他进程不能写。</p>
<p>我们来分析他们的关系，首先，这个问题没有明显的同步关系，因为在这个问题里，读和写并不要合作完成某些事情。但是是有互斥关系的，写者和写者，写者和读者是有互斥关系的，我们需要设置一个mutex来控制其访问，但是单纯一个信号量的话会出现读者和读者的互斥也出现了，因为我们可能有多个读者，所以我们设置一个变量ReadCount表示读者的数量，好，这个时候，对于ReadCount又要实现多个读者对他的互斥访问，所以还要设置一个RC_mutex。这样就好了。然后是行为设计：<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">void Reader<span class="comment">()</span> &#123;</span><br><span class="line">    <span class="keyword">while</span><span class="comment">(1)</span> &#123;</span><br><span class="line">        P<span class="comment">(&amp;RC_mutex)</span>;</span><br><span class="line">        rc = rc + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span><span class="comment">(rc == 1)</span> P<span class="comment">(&amp;mutex)</span>;  <span class="comment">//如果是第一个读者，那么限制写者的访问</span></span><br><span class="line">        V<span class="comment">(&amp;RC_mutex)</span>;</span><br><span class="line">        <span class="comment">//读数据</span></span><br><span class="line">        P<span class="comment">(&amp;RC_mutex)</span>;</span><br><span class="line">        rc = rc - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span><span class="comment">(rc == 0)</span> V<span class="comment">(&amp;mutex)</span>;  <span class="comment">//如果是最后一个读者，那么释放以供写者或读者访问</span></span><br><span class="line">        V<span class="comment">(&amp;RC_mutex)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Writer<span class="comment">()</span> &#123;</span><br><span class="line">    <span class="keyword">while</span><span class="comment">(1)</span> &#123;</span><br><span class="line">        P<span class="comment">(&amp;mutex)</span>;</span><br><span class="line">        <span class="comment">//写数据</span></span><br><span class="line">        V<span class="comment">(&amp;mutex)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>其实，这个方法是有一定问题的，只要趁前面的读者还没读完的时候新一个读者进来，这样一直保持，那么写者会一直得不到机会，导致饿死。有一种解决方法就是在一个写者到达时，如果后面还有新的读者进来，那么先挂起那些读者，先执行写者，但是这样的话并发度和效率又会降到很低。有人提出了一种写者优先的解法，有点不好理解，这里给出实现：<br><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写者优先的读者-写者问题解法</span></span><br><span class="line"></span><br><span class="line">Semaphore x = y = z = <span class="number">1</span><span class="comment">;    //x控制ReadCount的互斥访问，y控制WriteCount的互斥访问</span></span><br><span class="line">Semaphore rsem = wsem = <span class="number">1</span><span class="comment">;  //rsem,wsem分别表示对读和写的互斥控制</span></span><br><span class="line"><span class="keyword">int</span> ReadCount = WriteCount = <span class="number">0</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line">void Reader() &#123;</span><br><span class="line">    P(z)<span class="comment">;                       //z保证写跳过读，做到写优先</span></span><br><span class="line">    P(rsem)<span class="comment">;                    //控制对读的访问，如果有写者，那么此处不成功</span></span><br><span class="line">    P(x)<span class="comment">;                       //对RC的互斥控制</span></span><br><span class="line">    ReadCount++<span class="comment">;                </span></span><br><span class="line">    <span class="keyword">if</span>(ReadCount == <span class="number">1</span>) P(wsem)<span class="comment">; //第一个读者出现后，锁住不让写</span></span><br><span class="line">    V(x)<span class="comment">;</span></span><br><span class="line">    V(rsem)<span class="comment">;                    //释放读的访问，以使其他读者进入</span></span><br><span class="line">    V(z)<span class="comment">;</span></span><br><span class="line">    <span class="comment">//读数据...</span></span><br><span class="line">    P(x)<span class="comment">;</span></span><br><span class="line">    ReadCount--<span class="comment">;</span></span><br><span class="line">    <span class="keyword">if</span>(ReadCount == <span class="number">0</span>) V(wsem)<span class="comment">; //如果是最后一个读者，释放对写的信号</span></span><br><span class="line">    V(x)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Writer() &#123;</span><br><span class="line">    P(y)<span class="comment">;</span></span><br><span class="line">    WriteCount++<span class="comment">;</span></span><br><span class="line">    <span class="keyword">if</span>(WriteCount == <span class="number">1</span>) P(rsem)<span class="comment">;</span></span><br><span class="line">    V(y)<span class="comment">;</span></span><br><span class="line">    P(wsem)<span class="comment">;</span></span><br><span class="line">    <span class="comment">//写数据...</span></span><br><span class="line">    V(wsem)<span class="comment">;</span></span><br><span class="line">    P(y)<span class="comment">;</span></span><br><span class="line">    WriteCount--<span class="comment">;</span></span><br><span class="line">    <span class="keyword">if</span>(WriteCount == <span class="number">0</span>) V(rsem)<span class="comment">;</span></span><br><span class="line">    V(y)<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="问题3：哲学家就餐问题"><a href="#问题3：哲学家就餐问题" class="headerlink" title="问题3：哲学家就餐问题"></a>问题3：哲学家就餐问题</h3><p>哲学家就餐问题描述如下：</p>
<p>有五个哲学家，他们的生活方式是交替地进行思考和进餐，哲学家们共用一张圆桌，分别坐在周围的五张椅子上，在圆桌上有五个碗和五支筷子，平时哲学家进行思考，饥饿时便试图取其左、右最靠近他的筷子，只有在他拿到两支筷子时才能进餐，进餐完毕，放下筷子又继续思考。</p>
<p>约束条件<br>(1)只有拿到两只筷子时，哲学家才能吃饭。<br>(2)如果筷子已被别人拿走，则必须等别人吃完之后才能拿到筷子。<br>(3)任一哲学家在自己未拿到两只筷子吃饭前，不会放下手中拿到的筷子。<br>(4)用完之后将筷子返回原处</p>
<p>分析：筷子是临界资源，每次只被一个哲学家拿到，这是互斥关系。如果筷子被拿走，那么需要等待，这是同步关系。</p>
<p>容易想到一种错误的解法，所以设置一个信号量表示一只筷子，有5只筷子，所以设置5个信号量，哲学家每次饥饿时先试图拿左边的筷子，再试图拿右边的筷子，拿不到则等待，拿到了就进餐，最后逐个放下筷子。这种情况可能会产生死锁，因为我们不知道进程何时切换（这也是很多IPC问题的根本原因），如果5个哲学家同时饥饿，同时试图拿起左边的筷子，也很幸运地都拿到了，那么他们拿右边的筷子的时候都会拿不到，而根据第三个约束条件，都不会放下筷子，这就产生了死锁。《现代操作系统》中记载的一种解法是仅当一个哲学家左右的筷子都可用时，才拿起筷子，将“试图获取两个筷子”作为临界资源，用一个互斥量mutex实现对其的互斥控制，然后用n个变量记录哲学家的状态（饥饿，进餐，思考&lt;可有可无，因为除了前两者以外只会思考&gt;），然后用一个同步信号量数组，每个信号量对应一个哲学家，来保证哲学家得不到自己所需筷子的时候阻塞。算法如下：</p>
<center> <img src="http://images.cnitblog.com/blog2015/591194/201504/302312154437620.jpg" alt=""> </center>

<p>还有一种解法是让奇数号与偶数号的哲学家拿筷子的先后顺序不同，以破坏环路等待条件。还可以只允许4个哲学家同时进餐（4个人都拿起一只筷子的时候，第5个人不能再拿筷子，这样就会空出一只筷子）</p>
<h2 id="例子分析"><a href="#例子分析" class="headerlink" title="例子分析"></a>例子分析</h2><p>至此，我们已经可以总结出一点用信号量解决同步互斥问题的基本规律和一般步骤：</p>
<blockquote>
<p>（1）分析各进程间的制约关系，从而得出同步与互斥关系<br>（2）根据（1）中的分析，设置信号量<br>（3）编写伪代码，实施P,V操作</p>
</blockquote>
<p>同步：多个进程在执行次序上的协调，相互等待消息<br>互斥：对临界资源的使用</p>
<p>要注意的是，<strong>虽然P,V操作在每一个进程中都是成对出现的，但不一定是针对一个信号量。互斥信号量的P,V操作总是出现在一个进程中的临界区的前后，而同步信号量的P,V操作总是出现在具有同步关系的两个进程中，需要等待消息的一方执行P操作，发出消息的一方执行V操作。</strong></p>
<p>下面通过诸多例题来熟悉，掌握及训练用信号量解决同步与互斥问题的一般方法。</p>
<h3 id="问题4：放水果问题"><a href="#问题4：放水果问题" class="headerlink" title="问题4：放水果问题"></a>问题4：放水果问题</h3><p>桌上有一空盘，最多允许存放一只水果。爸爸可向盘中放一个苹果，妈妈可向盘中放一个桔子。<br>儿子专等吃盘中的桔子，女儿专等吃苹果。<br>试用P、V操作实现爸爸、妈妈、儿子、女儿四个并发进程的同步。</p>
<p>分析：临界资源是盘子，放的时候不能取，取的时候不能放，取的时候不能再取。同步关系：爸爸、妈妈与盘子为空，儿子与盘中有桔，女儿与盘中有苹果。</p>
<p>所以设置一个mutex互斥信号量来控制对盘子的访问，用empty，orange，apple分别代表以上同步关系。程序如下：<br><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Semaphore mutex = <span class="number">1</span><span class="comment">;</span></span><br><span class="line">Semaphore empty = <span class="number">1</span>, orange = apple = <span class="number">0</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line">mother:</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        P(empty)<span class="comment">;</span></span><br><span class="line">        P(mutex)<span class="comment">;</span></span><br><span class="line">        <span class="comment">//放入桔子</span></span><br><span class="line">        V(mutex)</span><br><span class="line">        V(orange)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">father:</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        P(empty)<span class="comment">;</span></span><br><span class="line">        P(mutex)<span class="comment">;</span></span><br><span class="line">        <span class="comment">//放入苹果</span></span><br><span class="line">        V(mutex)</span><br><span class="line">        V(apple)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">son:</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        P(orange)</span><br><span class="line">        P(mutex)</span><br><span class="line">        <span class="comment">//取桔子</span></span><br><span class="line">        V(mutex)<span class="comment">;</span></span><br><span class="line">        V(empty)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">daughter:</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        P(apple)</span><br><span class="line">        P(mutex)</span><br><span class="line">        <span class="comment">//取苹果</span></span><br><span class="line">        V(mutex)<span class="comment">;</span></span><br><span class="line">        V(empty)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="问题5：读文件问题"><a href="#问题5：读文件问题" class="headerlink" title="问题5：读文件问题"></a>问题5：读文件问题</h3><p>四个进程A、B、C、D都要读一个共享文件F，系统允许多个进程同时读文件F。但限制是进程A和进程C不能同时读文件F，进程B和进程D也不能同时读文件F。为了使这四个进程并发执行时能按系统要求使用文件，现用P、V操作进行管理。</p>
<p>分析：互斥关系：A和C读文件时互斥，B和D读文件时互斥，没有同步关系。</p>
<p>所以设置两个互斥信号量：AC_mutex,BD_mutex即可。伪代码如下：<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Semaphore AC_mutex = BD_mutex = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">A:</span><br><span class="line">    <span class="keyword">while</span><span class="comment">(1)</span> &#123;</span><br><span class="line">        P<span class="comment">(AC_mutex)</span>;</span><br><span class="line">        <span class="comment">//read F</span></span><br><span class="line">        V<span class="comment">(AC_mutex)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">B:</span><br><span class="line">    <span class="keyword">while</span><span class="comment">(1)</span> &#123;</span><br><span class="line">        P<span class="comment">(BD_mutex)</span>;</span><br><span class="line">        <span class="comment">//read F</span></span><br><span class="line">        V<span class="comment">(BD_mutex)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">C:</span><br><span class="line">    <span class="keyword">while</span><span class="comment">(1)</span> &#123;</span><br><span class="line">        P<span class="comment">(AC_mutex)</span>;</span><br><span class="line">        <span class="comment">//read F</span></span><br><span class="line">        V<span class="comment">(AC_mutex)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">D:</span><br><span class="line">    <span class="keyword">while</span><span class="comment">(1)</span> &#123;</span><br><span class="line">        P<span class="comment">(BD_mutex)</span>;</span><br><span class="line">        <span class="comment">//read F</span></span><br><span class="line">        V<span class="comment">(BD_mutex)</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="问题6：阅览室问题-图书馆问题"><a href="#问题6：阅览室问题-图书馆问题" class="headerlink" title="问题6：阅览室问题 / 图书馆问题"></a>问题6：阅览室问题 / 图书馆问题</h3><p>有一阅览室，读者进入时必须先在一张登记表上进行登记，该表为每一座位列一表目，包括座号和读者姓名。读者离开时要消掉登记信号<br>，阅览室中共有100个座位。用PV操作控制这个过程。</p>
<p>分析：</p>
<p>由于每个读者都会进行一样的操作：登记-&gt;进入-&gt;阅读-&gt;撤销登记-&gt;离开，所以建立一个读者模型即可。<br>临界资源有：座位，登记表<br>读者间有座位和登记表的互斥关系，所以设信号量empty表示空座位的数量，初始为100，mutex表示对登记表的互斥访问，初始为1。</p>
<p>P,V操作如下：<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Semaphore mutex = <span class="number">1</span>, empty = <span class="number">100</span>;</span><br><span class="line">Reader<span class="comment">()</span>：</span><br><span class="line"><span class="keyword">While</span><span class="comment">(true)</span> &#123;</span><br><span class="line">    P<span class="comment">(empty)</span>           <span class="comment">//申请空座位</span></span><br><span class="line">    P<span class="comment">(mutex)</span>           <span class="comment">//申请登记表</span></span><br><span class="line">    <span class="comment">//登记  </span></span><br><span class="line">    V<span class="comment">(mutex)</span>           <span class="comment">//释放登记表</span></span><br><span class="line">    <span class="comment">//进入阅读</span></span><br><span class="line">    P<span class="comment">(mutex)</span>            <span class="comment">//申请登记表</span></span><br><span class="line">    <span class="comment">//撤销登记</span></span><br><span class="line">    V<span class="comment">(mutex)</span>            <span class="comment">//释放登记表</span></span><br><span class="line">    V<span class="comment">(empty)</span>            <span class="comment">//释放座位</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="问题7：单行道问题"><a href="#问题7：单行道问题" class="headerlink" title="问题7：单行道问题"></a>问题7：单行道问题</h3><p>一段双向行驶的公路，由于山体滑坡，一小段路的一般车道被阻隔，该段每次只能容纳一辆车通过，一个方向的多个车辆可以紧接着通过，试用P,V操作控制此过程。</p>
<center> <img src="http://images.cnitblog.com/blog2015/591194/201505/010058320368735.jpg" alt=""> </center>

<p>分析：<br>临界资源为一半被阻隔的一小段区域，所以需要Go_mutex,Come_mutex来控制每个方向车辆通过该路段，以及实现两个方向的同步关系，同步关系即为：当某方向已有车辆在通行时，另一方向的车辆必须等待，反之亦然。类似于读者-写者问题，车辆从两边通过相当于两个读者，我们设立两个计数器A和B分别代表两个方向的汽车数量，还要设置两个信号量A_mutex和B_mutex来实现对计数器的互斥访问，因为山体滑坡处只允许一辆车通过，所以还需设置一个互斥量mutex保证相同方向的车辆依次通过该处。</p>
<p>于是程序如下（PV操作包含其中）：<br><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> &lt;Windows.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> &lt;stdio.h&gt;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> N <span class="number">100</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TRUE <span class="number">1</span></span></span><br><span class="line">typedef <span class="keyword">int</span> Semaphore<span class="comment">;</span></span><br><span class="line">Semaphore A = <span class="number">0</span>, B = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">HANDLE Go_mutex,Come_mutex<span class="comment">;</span></span><br><span class="line">HANDLE A_mutex,B_mutex<span class="comment">;</span></span><br><span class="line">HANDLE mutex<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">void down(HANDLE handle) &#123;</span><br><span class="line">    WaitForSingleObject(handle, INFINITE)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void up(HANDLE handle) &#123;</span><br><span class="line">    ReleaseSemaphore(handle, <span class="number">1</span>, NULL)<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD WINAPI Come(LPVOID v) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(TRUE) &#123;</span><br><span class="line"></span><br><span class="line">        down(Come_mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        down(A_mutex)<span class="comment">;</span></span><br><span class="line">        A = A+<span class="number">1</span><span class="comment">;</span></span><br><span class="line">        <span class="keyword">if</span>(A == <span class="number">1</span>) &#123;</span><br><span class="line">            down(Go_mutex)<span class="comment">;</span></span><br><span class="line">            printf(<span class="string">"                    &lt;&lt;&lt;=====开始自东向西\n"</span>)<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        up(A_mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        up(Come_mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        down(mutex)<span class="comment">;</span></span><br><span class="line">        <span class="comment">//自东向西通过该路段</span></span><br><span class="line">        printf(<span class="string">"                    &lt;&lt;&lt;=====第%s辆车\n"</span>,(char *)v)<span class="comment">;</span></span><br><span class="line">        printf(<span class="string">"         END        &lt;&lt;&lt;=====第%s辆车\n"</span>,(char *)v)<span class="comment">;</span></span><br><span class="line">        up(mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        down(A_mutex)<span class="comment">;</span></span><br><span class="line">        A = A<span class="number">-1</span><span class="comment">;</span></span><br><span class="line">        <span class="keyword">if</span>(A == <span class="number">0</span>) &#123;</span><br><span class="line">            up(Go_mutex)<span class="comment">;</span></span><br><span class="line">            printf(<span class="string">"                    自东向西的所有车辆行驶完毕\n"</span>)<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        up(A_mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        Sleep(<span class="number">2000</span>)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD WINAPI Go(LPVOID v) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(TRUE) &#123;</span><br><span class="line"></span><br><span class="line">        down(Go_mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        down(B_mutex)<span class="comment">;</span></span><br><span class="line">        B = B+<span class="number">1</span><span class="comment">;</span></span><br><span class="line">        <span class="keyword">if</span>(B == <span class="number">1</span>) &#123;</span><br><span class="line">            down(Come_mutex)<span class="comment">;</span></span><br><span class="line">            printf(<span class="string">"开始自西向东====&gt;\n"</span>)<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        up(B_mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        up(Go_mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        down(mutex)<span class="comment">;</span></span><br><span class="line">        <span class="comment">//自西向东通过该路段</span></span><br><span class="line">        printf(<span class="string">"第%s辆车=====&gt;&gt;&gt;\n"</span>,(char *)v)<span class="comment">;</span></span><br><span class="line">        printf(<span class="string">"第%s辆车=====&gt;&gt;&gt;     END\n"</span>,(char *)v)<span class="comment">;</span></span><br><span class="line">        up(mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        down(B_mutex)<span class="comment">;</span></span><br><span class="line">        B = B<span class="number">-1</span><span class="comment">;</span></span><br><span class="line">        <span class="keyword">if</span>(B == <span class="number">0</span>) &#123;</span><br><span class="line">            up(Come_mutex)<span class="comment">;</span></span><br><span class="line">            printf(<span class="string">"自西向东的所有车辆行驶完毕\n"</span>)<span class="comment">;</span></span><br><span class="line">        &#125;</span><br><span class="line">        up(B_mutex)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">        Sleep(<span class="number">2000</span>)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    DWORD Tid<span class="comment">;</span></span><br><span class="line">    char AThread[<span class="number">12</span>][<span class="number">10</span>]<span class="comment">;</span></span><br><span class="line">    char BThread[<span class="number">12</span>][<span class="number">10</span>]<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    mutex      = CreateSemaphore(NULL, <span class="number">1</span>, <span class="number">1</span>, NULL)<span class="comment">;</span></span><br><span class="line">    A_mutex    = CreateSemaphore(NULL, <span class="number">1</span>, <span class="number">1</span>, NULL)<span class="comment">;</span></span><br><span class="line">    B_mutex    = CreateSemaphore(NULL, <span class="number">1</span>, <span class="number">1</span>, NULL)<span class="comment">;</span></span><br><span class="line">    Go_mutex   = CreateSemaphore(NULL, <span class="number">1</span>, <span class="number">1</span>, NULL)<span class="comment">;</span></span><br><span class="line">    Come_mutex = CreateSemaphore(NULL, <span class="number">1</span>, <span class="number">1</span>, NULL)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span><span class="comment">;i&lt;4;i++) &#123;</span></span><br><span class="line">        AThread[i][<span class="number">0</span>] = i+<span class="number">1</span>+<span class="string">'0'</span><span class="comment">;</span></span><br><span class="line">        AThread[i][<span class="number">1</span>] = <span class="string">'\0'</span><span class="comment">;</span></span><br><span class="line">        CreateThread(NULL,<span class="number">0</span>,Come,AThread[i],<span class="number">0</span>,&amp;Tid)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">4</span><span class="comment">;i&lt;8;i++) &#123;</span></span><br><span class="line">        BThread[i][<span class="number">0</span>] = i+<span class="number">1</span>+<span class="string">'0'</span><span class="comment">;</span></span><br><span class="line">        BThread[i][<span class="number">1</span>] = <span class="string">'\0'</span><span class="comment">;</span></span><br><span class="line">        CreateThread(NULL,<span class="number">0</span>,Go,BThread[i],<span class="number">0</span>,&amp;Tid)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Sleep(<span class="number">20000</span>)<span class="comment">;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<center> <img src="http://images0.cnblogs.com/blog2015/591194/201505/241529590481971.png" alt=""> </center>

<p>从其中可以看出，车辆正常交替顺序通过该路段。数字重复出现是因为线程被重复地调度执行。</p>
<h3 id="问题8：理发师问题"><a href="#问题8：理发师问题" class="headerlink" title="问题8：理发师问题"></a>问题8：理发师问题</h3><p>理发店理有一位理发师、一把理发椅和n把供等候理发的顾客坐的椅子 如果没有顾客，理发师便在理发椅上睡觉。 一个顾客到来时，它必须叫醒理发师，如果理发师正在理发时又有顾客来到，则如果有空椅子可坐，就坐下来等待，否则就离开。用PV操作管理该过程。</p>
<p>分析：</p>
<p>法1：首先设置一个count表示等待的人数（包括理发椅上的那个人），初值为0，以供后来者判断是否应该离开。同时对count的访问要保证互斥，所以设置mutex信号量来保证互斥，初值为1。<br>临界资源：凳子，理发椅。 分别设置waitchair,barchair信号量，初值分别为n和1，表示临界资源数量。<br>同步关系：顾客和理发师之间有同步关系，用ready和done信号量来表示，初值均为0，ready表示顾客有没有准备好，done表示理发师是否完成一次理发。<br>注意：<strong>并非每一个进程都需要while(1)无限循环，比如此例，顾客剪完一次头发就走了，不可能马上再来剪，而以前的生产者-消费者不同，他们都是可以不断生产消费的。</strong></p>
<p>写出P,V操作如下：<br><figure class="highlight hsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Semaphore waitchair = n<span class="comment">;</span></span><br><span class="line">Semaphore barchair = <span class="number">1</span><span class="comment">;</span></span><br><span class="line">Semaphore ready = done = <span class="number">0</span><span class="comment">;</span></span><br><span class="line"><span class="keyword">int</span> count = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">Semaphore mutex = <span class="number">1</span><span class="comment">;</span></span><br><span class="line"></span><br><span class="line">barber:</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        P(ready)<span class="comment">;</span></span><br><span class="line">        理发</span><br><span class="line">        V(done)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">consumer:</span><br><span class="line">    P(mutex)<span class="comment">;</span></span><br><span class="line">    <span class="keyword">if</span>(count &lt;= n) &#123;</span><br><span class="line">        count = count + <span class="number">1</span><span class="comment">;</span></span><br><span class="line">        V(mutex)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        V(mutex)<span class="comment">;</span></span><br><span class="line">        离开</span><br><span class="line">    &#125;</span><br><span class="line">    P(waitchair)<span class="comment">;</span></span><br><span class="line">    P(barchair)<span class="comment">;</span></span><br><span class="line">    V(waitchair)<span class="comment">;   //离开等待椅去理发椅需要释放等待椅!</span></span><br><span class="line">    V(ready)<span class="comment">;       //准备好了</span></span><br><span class="line">    P(done)<span class="comment">;        //等待理发完成</span></span><br><span class="line">    V(barchair)<span class="comment">;</span></span><br><span class="line">    P(mutex)<span class="comment">;</span></span><br><span class="line">    count = count - <span class="number">1</span><span class="comment">;</span></span><br><span class="line">    V(mutex)<span class="comment">;</span></span><br><span class="line">    离开</span><br></pre></td></tr></table></figure></p>
<p>法2：将凳子和理发椅看做同一种资源，因为只要理发椅空就一定会有人凑上去，所以相当于每个位置都是理发椅，理发师只需要去每个有人的座位理发即可。<br>还是设置count表示正在理发店中的人数，以便决定后来者是否离开。<br>同步关系仍用ready和done来表示。</p>
<p>算法：<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Semaphore ready = done = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">int <span class="built_in">count</span> = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">Semaphore mutex = <span class="number">1</span><span class="comment">;</span></span><br><span class="line"><span class="symbol"></span><br><span class="line">barber:</span></span><br><span class="line">    while(<span class="number">1</span>) &#123;</span><br><span class="line">        P(ready)<span class="comment">;</span></span><br><span class="line">        理发</span><br><span class="line">        V(done)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="symbol"></span><br><span class="line">consumer:</span></span><br><span class="line">    P(mutex)<span class="comment">;</span></span><br><span class="line">    if(<span class="built_in">count</span> &lt;= n) &#123;</span><br><span class="line">        <span class="built_in">count</span> = <span class="built_in">count</span> + <span class="number">1</span><span class="comment">;</span></span><br><span class="line">        V(mutex)<span class="comment">;</span></span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        V(mutex)<span class="comment">;</span></span><br><span class="line">        离开</span><br><span class="line">    &#125;</span><br><span class="line">    V(ready)<span class="comment">;       //准备好了</span></span><br><span class="line">    P(done)<span class="comment">;        //等待理发完成</span></span><br><span class="line">    P(mutex)<span class="comment">;      //也可由理发师来做count-1的操作</span></span><br><span class="line">    <span class="built_in">count</span> = <span class="built_in">count</span> - <span class="number">1</span><span class="comment">;</span></span><br><span class="line">    V(mutex)<span class="comment">;</span></span><br><span class="line">    离开</span><br></pre></td></tr></table></figure></p>
<p>好了，先说这么多，例题会持续更新增加，感兴趣的朋友可以关注下。<br>鄙人学力有限，有不足或错误之处敬请指出，不胜感激。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>1.《现代操作系统》           –Andrew S. Tanenbaum<br>2.《操作系统设计与实现》 –Andrew S. Tanenbaum<br>3.《操作系统精髓与设计原理》  –Strling<br>4.《2015操作系统高分笔记》  –刘泱主编</p>
  
	</div>


    
	<!-- css -->
	<style type="text/css">
	    .center {
	        text-align: center;
	    }
	    .hidden {
	        display: none;
	    }
		.donate_bar a.btn_donate{
			display: inline-block;
			width: 82px;
			height: 82px;
			background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
			_background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

			<!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
			     因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
				 为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
				 嵌入其它博客时不一定要它们。 -->
			-webkit-transition: background 0s;
			-moz-transition: background 0s;
			-o-transition: background 0s;
			-ms-transition: background 0s;
			transition: background 0s;
			<!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
		}

		.donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
		.donate_bar .donate_txt {
			display: block;
			color: #9d9d9d;
			font: 14px/2 "Microsoft Yahei";
		}
		.bold{ font-weight: bold; }
	</style>
	<!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

	<!-- btn_donate & tips -->
	<div id="donate_board" class="donate_bar center">
	    <br>
	    ------------------------------------------------------------------------------------------------------------------------------
	    <br>
		<a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
		<span class="donate_txt">
			听说，打赏我的人最后都找到了真爱。
		</span>
			
		
	</div>
	<!-- /btn_donate & tips -->

	<!-- donate guide -->
    
	<div id="donate_guide" class="donate_bar center hidden">
        <br>
	    ------------------------------------------------------------------------------------------------------------------------------
	    <br>
	    
	    <div width="100%" align="center"><div name="dashmain" id="dash-main-id-87895f" class="dash-main-3 87895f-0.99"></div></div>
		<script type="text/javascript" charset="utf-8" src="http://www.dashangcloud.com/static/ds.js"></script>
		

		<a href="http://7xsl28.com1.z0.glb.clouddn.com/wechatpay.png" title="用微信扫一扫哦~" class="fancybox" rel="article0">
			<img src="http://7xsl28.com1.z0.glb.clouddn.com/wechatpay.png" title="微信打赏 Donate" height="190px" width="auto"/>
		</a>
        
        &nbsp;&nbsp;

		<a href="http://7xsl28.com1.z0.glb.clouddn.com/alipay.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
			<img src="http://7xsl28.com1.z0.glb.clouddn.com/alipay.jpg" title="支付宝打赏 Donate" height="190px" width="auto"/>
		</a>

		<span class="donate_txt">
			听说，打赏我的人最后都找到了真爱。
		</span>

	</div>
	<!-- /donate guide -->

	<!-- donate script -->
	<script type="text/javascript">
		document.getElementById('btn_donate').onclick = function() {
			$('#donate_board').addClass('hidden');
			$('#donate_guide').removeClass('hidden');
		}

		function donate_on_web(){
			$('#donate').submit();
        }

		var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
		}
	</script>
	<!-- /donate script -->
</div>
<!-- /Donate Module -->
   

		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  
  <span></span> <a href="/categories/计算机相关-CS-Related/">计算机相关 | CS.Related</a>
  </div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/CS/">CS</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	<div class="share-jiathis">
	  
<div class="jiathis_style_24x24">
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_douban"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
     ralateuid:{"tsina":"husuche## e.g. 2176287895 Your weibo id,It will be used in share button."},hideMore:false}
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=2094149
2094149" charset="utf-8"></script>      

	 </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2017/03/11/candcplusplusmemo.html" title="C/C++语言备忘">
  <strong>上一篇：</strong><br/>
  <span>
  C/C++语言备忘</span>
</a>
</div>


<div class="next">
<a href="/2017/02/27/deeplearning0.html"  title="Deep Learning读书笔记系列 写作计划">
 <strong>下一篇：</strong><br/> 
 <span>Deep Learning读书笔记系列 写作计划
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <aside class="clearfix">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#概念"><span class="toc-number">2.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#经典问题"><span class="toc-number">3.</span> <span class="toc-text">经典问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#问题1：生产者-消费者问题"><span class="toc-number">3.1.</span> <span class="toc-text">问题1：生产者-消费者问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题2：读者-写者问题"><span class="toc-number">3.2.</span> <span class="toc-text">问题2：读者-写者问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题3：哲学家就餐问题"><span class="toc-number">3.3.</span> <span class="toc-text">问题3：哲学家就餐问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#例子分析"><span class="toc-number">4.</span> <span class="toc-text">例子分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#问题4：放水果问题"><span class="toc-number">4.1.</span> <span class="toc-text">问题4：放水果问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题5：读文件问题"><span class="toc-number">4.2.</span> <span class="toc-text">问题5：读文件问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题6：阅览室问题-图书馆问题"><span class="toc-number">4.3.</span> <span class="toc-text">问题6：阅览室问题 / 图书馆问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题7：单行道问题"><span class="toc-number">4.4.</span> <span class="toc-text">问题7：单行道问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题8：理发师问题"><span class="toc-number">4.5.</span> <span class="toc-text">问题8：理发师问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考文献"><span class="toc-number">5.</span> <span class="toc-text">参考文献</span></a></li></ol>
 
 </aside>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="about">
    <p class="asidetitle">Short bio</p>
    <div class="clearfix">
        <!-- <img src="http://7xsl28.com1.z0.glb.clouddn.com/niuzai.jpg" height="74px" width="74px" id="about-image" alt> -->
        <span style="font-size: medium; font-family: Calibri Light, Open Sans, Microsoft YaHei Light">
        whatbeg.com is written by Qiu Hu. Now Qiu Hu is a Master Grad. living in Nanjing, Jiangsu Province, China.
        <br>
        You can contact me with email.
        <br>
        Just enjoy your reading here!
        <br>
        Comments are always welcome:)
        </span>
    </div>
</div>


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/大数据系统与技术-Big-Data/" title="大数据系统与技术 | Big Data">大数据系统与技术 | Big Data<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/成长之路-Biography/" title="成长之路 | Biography">成长之路 | Biography<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据科学-Data-Science/" title="数据科学 | Data Science">数据科学 | Data Science<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/机器学习-Mac-Learning/" title="机器学习 | Mac.Learning">机器学习 | Mac.Learning<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/深度学习-Deep-Learning/" title="深度学习 | Deep Learning">深度学习 | Deep Learning<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法-Algorithm/" title="算法 | Algorithm">算法 | Algorithm<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程语言-Program-Lang/" title="编程语言 | Program Lang.">编程语言 | Program Lang.<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/计算机相关-CS-Related/" title="计算机相关 | CS.Related">计算机相关 | CS.Related<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/译文-Translation/" title="译文 | Translation">译文 | Translation<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书-Reading/" title="读书 | Reading">读书 | Reading<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/错误解决与优化-Err-n-Opt/" title="错误解决与优化 | Err_n_Opt">错误解决与优化 | Err_n_Opt<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/随笔-Essays/" title="随笔 | Essays">随笔 | Essays<sup>6</sup></a></li>
		  
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">归档</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">23</span></li></ul>
  </div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/CS/" style="font-size: 16.67px;">CS</a> <a href="/tags/Deep-Learning/" style="font-size: 12.22px;">Deep Learning</a> <a href="/tags/Git/" style="font-size: 11.11px;">Git</a> <a href="/tags/Hadoop/" style="font-size: 13.33px;">Hadoop</a> <a href="/tags/Latex/" style="font-size: 10px;">Latex</a> <a href="/tags/Linux/" style="font-size: 12.22px;">Linux</a> <a href="/tags/Python/" style="font-size: 18.89px;">Python</a> <a href="/tags/Spark/" style="font-size: 10px;">Spark</a> <a href="/tags/Summary/" style="font-size: 14.44px;">Summary</a> <a href="/tags/TensorFlow/" style="font-size: 10px;">TensorFlow</a> <a href="/tags/Web/" style="font-size: 12.22px;">Web</a> <a href="/tags/hexo/" style="font-size: 15.56px;">hexo</a> <a href="/tags/吃喝玩乐/" style="font-size: 10px;">吃喝玩乐</a> <a href="/tags/大数据/" style="font-size: 13.33px;">大数据</a> <a href="/tags/影视/" style="font-size: 11.11px;">影视</a> <a href="/tags/数据分析/" style="font-size: 16.67px;">数据分析</a> <a href="/tags/机器学习/" style="font-size: 20px;">机器学习</a> <a href="/tags/深度学习/" style="font-size: 15.56px;">深度学习</a> <a href="/tags/算法/" style="font-size: 12.22px;">算法</a> <a href="/tags/论文阅读/" style="font-size: 10px;">论文阅读</a> <a href="/tags/译文/" style="font-size: 11.11px;">译文</a> <a href="/tags/读书/" style="font-size: 17.78px;">读书</a> <a href="/tags/随笔/" style="font-size: 14.44px;">随笔</a>
    </div>
  </div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www.cnblogs.com/whatbeg/" target="_blank" title="Old Blog">Old Blog</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/whatbeg" target="_blank" title="My Github">My Github</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.matrix67.com/blog/" target="_blank" title="Matrix67">Matrix67</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.liaoxuefeng.com/" target="_blank" title="廖雪峰">廖雪峰</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.ruanyifeng.com/blog/" target="_blank" title="阮一峰">阮一峰</a>
            
          </li>
        
          <li>
            
            	<a href="http://mindhacks.cn/" target="_blank" title="刘未鹏">刘未鹏</a>
            
          </li>
        
          <li>
            
            	<a href="http://machinelearningmastery.com/blog/" target="_blank" title="ML MYSTERY">ML MYSTERY</a>
            
          </li>
        
          <li>
            
            	<a href="http://freemind.pluskid.org/" target="_blank" title="Free Mind">Free Mind</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.csdn.net/zouxy09/" target="_blank" title="zouxy机器学习">zouxy机器学习</a>
            
          </li>
        
          <li>
            
            	<a href="http://coolshell.cn" target="_blank" title="酷壳">酷壳</a>
            
          </li>
        
    </ul>
</div>

  <table height=30 cellSpacing=0 cellPadding=0 width=180 border=0>
<form action="http://www.sogou.com/web" target="_blank">
<tr style='font-size:12px;color:#000000'>
<td align="center" width=100><input type="text" name="query" size=14 style='BORDER-RIGHT: #999 1px solid; BORDER-TOP: #999 1px solid; BORDER-LEFT: #999	1px	solid; BORDER-BOTTOM: #999 1px solid; HEIGHT: 19px; BACKGROUND-COLOR: #fff'>
<input type="hidden" name="insite" value="whatbeg.com">
<input type="hidden" name="insite2" value="whatbeg.com"></td>
<td align="left" width=45><input type="submit" name="sogou_submit" value="搜索">
</td></tr></form>
</table>



  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="rsspart">
	<a href="http://eepurl.com/cHO5An" target="_blank" title="email">Email 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
        

	    
		
				<div class="cc-license">
          <a href="http://creativecommons.org/licenses/by-nc-nd/4.0" class="cc-opacity" target="_blank">
            <img src="/img/cc-by-nc-nd.svg" alt="Creative Commons" />
          </a>
        </div>
    

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016-2017 
		
		<a href="/about" target="_blank" title="whatbeg">whatbeg</a>
		
		<br>
		<span class="post-count">Total words: <span style="color:orange">239.2k</span></span>
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">
        &nbsp;&nbsp;Total visits:&nbsp;<span style="color:orange" id="busuanzi_value_site_pv"></span>
        </span>
        <span id="busuanzi_container_site_uv">
        &nbsp;&nbsp;You are Visitor No.<span style="color:orange" id="busuanzi_value_site_uv"></span>
        </span>
        </br>
		</p>
		
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    $('#toc.toc-aside').css('display', 'block').addClass('fadeIn');  //侧边栏显示文章目录
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');   //侧边栏显示widget
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>





<script type="text/javascript">

var disqus_shortname = 'whatbeg';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1258390595'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1258390595%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->
<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
  </body>
</html>


