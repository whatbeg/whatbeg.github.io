
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Ray 论文解读 | Whatbeg&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="whatbeg">
    

    
    <meta name="description" content="Ray是UC.Berkerly去年（2017）提出来的一个分布式执行引擎。Ray主要面向未来交互式的AI，如强化学习，提供任务并行和高速的任务调度。用户可以借助Ray迅速的进行任务并行来加速模型训练和推理。本文对Ray论文进行解读，以进一步地剖析了解Ray的运作原理，灵感来源，优缺点，在分布式机器学习框架中所处的位置，以及论文的写作，阐述过程等等。希望能给大家带来一些启发和思考。
摘要（Abstr">
<meta property="og:type" content="article">
<meta property="og:title" content="Ray 论文解读">
<meta property="og:url" content="http://whatbeg.com/2018/03/15/ray-paper.html">
<meta property="og:site_name" content="Whatbeg's blog">
<meta property="og:description" content="Ray是UC.Berkerly去年（2017）提出来的一个分布式执行引擎。Ray主要面向未来交互式的AI，如强化学习，提供任务并行和高速的任务调度。用户可以借助Ray迅速的进行任务并行来加速模型训练和推理。本文对Ray论文进行解读，以进一步地剖析了解Ray的运作原理，灵感来源，优缺点，在分布式机器学习框架中所处的位置，以及论文的写作，阐述过程等等。希望能给大家带来一些启发和思考。
摘要（Abstr">
<meta property="og:image" content="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-01.jpg">
<meta property="og:image" content="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-02.jpg">
<meta property="og:image" content="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-03.jpg">
<meta property="og:image" content="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-04.jpg">
<meta property="og:image" content="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-05.jpg">
<meta property="og:updated_time" content="2018-03-18T07:59:51.303Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ray 论文解读">
<meta name="twitter:description" content="Ray是UC.Berkerly去年（2017）提出来的一个分布式执行引擎。Ray主要面向未来交互式的AI，如强化学习，提供任务并行和高速的任务调度。用户可以借助Ray迅速的进行任务并行来加速模型训练和推理。本文对Ray论文进行解读，以进一步地剖析了解Ray的运作原理，灵感来源，优缺点，在分布式机器学习框架中所处的位置，以及论文的写作，阐述过程等等。希望能给大家带来一些启发和思考。
摘要（Abstr">
<meta name="twitter:image" content="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-01.jpg">

    
    <link rel="alternative" href="/atom.xml" title="Whatbeg&#39;s blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/w.ico">
    
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Whatbeg&#39;s blog">Whatbeg&#39;s blog</a></h1>
				<h2 class="blog-motto">当你的才华撑不起你的野心时，就应该静下心来好好学习。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页(Home)</a></li>
					
						<li><a href="/archives">归档(Archives)</a></li>
					
						<li><a href="/tags">标签(Tags)</a></li>
					
						<li><a href="/categories">分类(Categories)</a></li>
					
						<li><a href="/about">关于(About)</a></li>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2018/03/15/ray-paper.html" title="Ray 论文解读" itemprop="url">Ray 论文解读</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="whatbeg" target="_blank" itemprop="author">whatbeg</a>
		
  <p class="article-time">
    <time datetime="2018-03-15T06:26:53.000Z" itemprop="datePublished"> 发表于 2018-03-15</time>
    <span id="busuanzi_container_page_pv">
    总阅读<span id="busuanzi_value_page_pv"></span>次
    </span>
  </p>

</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#摘要（Abstract）"><span class="toc-number">1.</span> <span class="toc-text">摘要（Abstract）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#介绍（Introduction）"><span class="toc-number">2.</span> <span class="toc-text">介绍（Introduction）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Motivation-and-Requirements"><span class="toc-number">3.</span> <span class="toc-text">Motivation and Requirements</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编程模型和计算模型（Programming-and-Computation-Model）"><span class="toc-number">4.</span> <span class="toc-text">编程模型和计算模型（Programming and Computation Model）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#编程模型"><span class="toc-number">4.1.</span> <span class="toc-text">编程模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#计算模型"><span class="toc-number">4.2.</span> <span class="toc-text">计算模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#架构（Architecture）"><span class="toc-number">5.</span> <span class="toc-text">架构（Architecture）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#应用层"><span class="toc-number">5.1.</span> <span class="toc-text">应用层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统层-Global-Control-State"><span class="toc-number">5.2.</span> <span class="toc-text">系统层-Global Control State</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统层-Distributed-Bottom-Up-Scheduler"><span class="toc-number">5.3.</span> <span class="toc-text">系统层-Distributed Bottom-Up Scheduler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统层-Distributed-Object-Store"><span class="toc-number">5.4.</span> <span class="toc-text">系统层-Distributed Object Store</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#相关工作"><span class="toc-number">6.</span> <span class="toc-text">相关工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">7.</span> <span class="toc-text">总结</span></a></li></ol>
		
		</div>
		
		<p>Ray是UC.Berkerly去年（2017）提出来的一个分布式执行引擎。Ray主要面向未来交互式的AI，如强化学习，提供任务并行和高速的任务调度。用户可以借助Ray迅速的进行任务并行来加速模型训练和推理。本文对Ray论文进行解读，以进一步地剖析了解Ray的运作原理，灵感来源，优缺点，在分布式机器学习框架中所处的位置，以及论文的写作，阐述过程等等。希望能给大家带来一些启发和思考。</p>
<h2 id="摘要（Abstract）"><a href="#摘要（Abstract）" class="headerlink" title="摘要（Abstract）"></a>摘要（Abstract）</h2><p>摘要部分简洁明了。首先说下一代的AI应用会持续地与环境进行交互，即走向交互式学习，在交互中学习，故而对支持AI的底层系统提出了新要求。论文阐述了这些要求（如性能，灵活性方面的要求），并提出Ray这一框架来满足这些要求。Ray实现了动态任务图计算（dynamic task graph computation），支持任务并行（task-parallel）和Actor编程模型。</p>
<p>为了满足性能（Performance）要求，Ray提出了一种逻辑中心控制状态板的概念，采用分片的分布式存储系统（Redis）来实现，以及提供了一种新颖的自底向上的分布式调度器。</p>
<p>实验表明，Ray可以实现次毫秒级的任务调度延迟，任务吞吐量大，在很多challenging的benchmark上得到了加速，并且自然且高效地适配新兴的一类强化学习应用与算法。</p>
<p>摘要部分的逻辑非常清晰，首先说明问题，问题提出的新要求，为了解决问题，满足要求，我们提出xx，xx具有…的性质，提出了…idea，实验表明，xx具有良好的效果。简单来说就是：<strong>问题-方法-效果</strong>三大块，看起来很舒服。</p>
<h2 id="介绍（Introduction）"><a href="#介绍（Introduction）" class="headerlink" title="介绍（Introduction）"></a>介绍（Introduction）</h2><p><strong>(Situation)</strong> AI目前风生水起，应用广泛。过去主要集中在监督学习上，离线训练在线部署，如今领域(AI,ML)逐渐成熟，呈现新需求：AI系统需要在动态环境中不断响应变化，与环境交互来学习。这种模式天生与强化学习契合。强化学习应用也取得了一些很好的效果。</p>
<p>强化学习与监督学习有三点不同：</p>
<ul>
<li>强化学习依赖大量的模拟动作</li>
<li>强化学习的计算图是异构的，动态演化的，每部分的计算时间可能差别很大</li>
<li>需要快速作出响应</li>
</ul>
<p><strong>(Question)</strong> 总的来说，我们需要这样一个计算框架：支持异构的、动态的计算图，每秒处理百万级任务数，且只有毫秒级的延迟。</p>
<p><strong>(Conflict)</strong> 已有的集群计算框架无法充分满足这些要求。</p>
<p>MapReduce, Spark, Dryad, Dask, CIEL 既不能提供强化学习应用需要的吞吐量，也不能达到其要求的延迟。</p>
<p>Tensorflow, Naiad, MPI, Canary 通常假设计算图是静态的。</p>
<p><strong>(Answer)</strong> 本文提出Ray，一个新的满足这些条件的集群计算框架。</p>
<p>为了满足：</p>
<ul>
<li>条件1：异构动态工作流 =&gt; Ray实现了动态任务图计算模型，类似于CIEL，并在CIEL的任务并行之上提供了一个actor编程模型，actor抽象使得Ray能够支持有状态组件，封装第三方服务。</li>
</ul>
<p>【什么是actor抽象？】actor可以理解为一个第三方服务的代理，或者一个类，类中包含了成员变量和方法，成员方法可以调用某些第三方服务，故而actor相当于对第三方服务的一个封装和一个抽象，真正的实现可以是各种第三方服务。在编程语言中的实现就是像类一样实现，只不过在类定义前加一个<code>@ray.remote</code>而已。</p>
<ul>
<li>条件2：高性能 =&gt; 采用一种新的分布式架构，可以实现良好的水平扩展。主要基于两个idea：<br>1）中央控制板，系统的所有控制状态都属中央控制，各个组件可以实现无状态，从而实现良好的水平扩展和容错。<br>2）自底向上的分布式调度器。即有一个全局调度器(global scheduler)，每个节点有本地调度器(local scheduler)，本地调度器可以选择本地调度，也可以将任务转发给global scheduler，让global scheduler来进行调度。</li>
</ul>
<p>【问题一】看到这里，读者可能会问，何时决定选择本地调度还是往上层转发呢？采何种标准决定到底是本地调度还是往上层转发呢？这是后续需要回答的问题。</p>
<p>可以看到，介绍部分的基本逻辑清晰，我们采用SCQA/SQCA分析法来分析，首先介绍现在的处境(Situation)，然后提出问题（我们需要xxx）(Question)，然后是冲突(Conflict)，即现在没有满足这些条件的框架，最后是答案(Answer)，即我们提出Ray…。这种写法可以叫SQCA法，也可以调一下顺序，按SCQA的顺序来写。</p>
<p>论文有如下贡献：</p>
<ul>
<li>提出当前AI系统的一些要求</li>
<li>提出了actor抽象</li>
<li>提出具有高度水平扩展性的一种架构，并构建Ray来实现。</li>
</ul>
<p>【问题二】水平扩展的方式，能否支撑大数据？</p>
<p>Ray的架构：</p>
<table><tr><th colspan="3"><center>Application Layer</center></th></tr><tr><td><center>global control state</center></td><td><center>distributed scheduler</center></td><td><center>distributed object store</center></td></tr></table>

<h2 id="Motivation-and-Requirements"><a href="#Motivation-and-Requirements" class="headerlink" title="Motivation and Requirements"></a>Motivation and Requirements</h2><p>强化学习工作流是Ray设计的主要动机，也是本文重点。<br>以强化学习为例，本文将新型系统的要求分为三大类：</p>
<ul>
<li>Flexibility</li>
</ul>
<p>Flexibility又分为几个方面：<br>一个是并发任务的异构性，有以下三种，功能不同，时长不同以及资源类型不同。如视频的处理和文本的处理就不是同一个功能，在一个时长，执行的计算也不一样。资源类型指的是GPU或者CPU等。</p>
<p><img src="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-01.jpg" alt=""></p>
<p>另一个是执行图的通用性和动态性。</p>
<p>上面这些要求，BSP的模型（如Hadoop MapReduce, Apache Spark）是无法满足的。<br>在BSP模型中，每个Stage执行的计算通常是相同的，故而计算所需的时间也相似。</p>
<ul>
<li>Performance</li>
</ul>
<p>机器人与环境交互的场景中，需要在ms级别采取反应给出action，所以调度最好在1ms内完成，否则会成为一块拖累。鉴于集群中核数达几百几千甚为常见，调度吞吐量应该要很大。</p>
<p>所以其实Ray对任务的快速调度做得比较好，能够做到非常快速的调度，因为就是针对这个需求设计的。</p>
<ul>
<li>Ease of Deployment</li>
</ul>
<p>写并行程序本来就不容易。简化开发对于一个系统的成功来说是至关重要的。<br>易用性包括几个方面：</p>
<ul>
<li>确定型的重放以及容错机制。</li>
<li>已有算法易并行。包括对Python语言的支持，以及提供第三方服务的紧密集成，这方面采用actor抽象来封装第三方服务。</li>
</ul>
<h2 id="编程模型和计算模型（Programming-and-Computation-Model）"><a href="#编程模型和计算模型（Programming-and-Computation-Model）" class="headerlink" title="编程模型和计算模型（Programming and Computation Model）"></a>编程模型和计算模型（Programming and Computation Model）</h2><p>不同于其他系统，Ray提供了actor和task-parallel两重编程抽象。<br>不像CIEL，只提供任务并行抽象，或Orleans，只提供actor抽象。</p>
<h3 id="编程模型"><a href="#编程模型" class="headerlink" title="编程模型"></a>编程模型</h3><p>当一个带有<code>@remote</code>注解的remote函数被调用，会立即返回一个<code>future</code>对象，然后调用<code>ray.get</code>即可得到结果。</p>
<p>比如说<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> ray</span><br><span class="line"></span><br><span class="line">ray.init()</span><br><span class="line"></span><br><span class="line"><span class="meta">@ray.remote</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">()</span>:</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Execute f in parallel.</span></span><br><span class="line">object_ids = [f.remote() <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>)]</span><br><span class="line">results = ray.get(object_ids)</span><br></pre></td></tr></table></figure></p>
<p><code>f.remote()</code>调用运行时，将返回一个<code>future</code>对象，存储在<code>object_ids</code>中，调用<code>ray.get(object_ids)</code>可以得到返回值的列表。</p>
<p>remote函数操作的数据是不可变的对象，remote函数是无状态，无副作用的，使得幂等性得以保证，从而简化了容错的处理。</p>
<p>为了满足一些条件，Ray所提出了的编程模型如下：</p>
<ul>
<li><p>处理不同时长的任务，采用了<code>ray.wait()</code>，这个调用的意思是，运行很多的task后，可以设定等待的个数，当一定个数的任务执行完成时，其他不再执行，整个调用也结束，返回“等待的”一些<code>future</code>的子集。思想类似于Spark的backup机制，即运行同样的多个任务，哪个先完成就用哪个的结果，其他的马上停止，不再考虑。</p>
</li>
<li><p>为了解决资源异构任务，在Ray中，开发者可以自己制定remote函数所需的资源量，资源种类有CPU，GPU（官方支持），以及自定义的resources。同样地，Actor也可以制定资源，但是目前Ray在调度Actor的时候，只根据GPU资源来调度。<a href="http://ray.readthedocs.io/en/latest/resources.html#current-limitations" target="_blank" rel="external">见这里</a></p>
</li>
<li><p>为了提升flexibility，在Ray中，remote函数可以相互嵌套，即在remote函数中可以调用remote函数，这样可以充分提高可扩展性，同样提高灵活性。</p>
</li>
<li><p>为了容易部署和保证高效性，Ray中涉及了Actor抽象，可以用来封装第三方服务。</p>
</li>
</ul>
<h3 id="计算模型"><a href="#计算模型" class="headerlink" title="计算模型"></a>计算模型</h3><p>Ray采用了动态计算图机制，即一旦输入准备好了，就自动触发remote函数或者actor方法执行。</p>
<p>那么Ray是如何将一个用户程序转换成计算图的呢？</p>
<p>不考虑actor的情况下，整个计算图的节点只包含两种类型的对象，数据对象和remote函数调用，或者称为task。</p>
<p>计算图有两种类型的边，数据边(data edge)和控制边(control edge)。</p>
<p>具体如下：<br>数据对象用D表示，task用T表示。<br>如果任务T产生输出D，那么T-&gt;D建一条边<br>如果D是T的输入，那么D-&gt;T有一条边<br>如果T1中调用了T2，那么T1-&gt;T2有一条边</p>
<p>考虑actor的情况下，增加一种数据对象即actor的方法(Method)，增加一种边，叫做有状态边(stateful edge)，表示一种执行的先后顺序。<br>因为同一个actor中，方法的执行是顺序的，无法并行，Mi-&gt;Mj的边即表示先执行方法Mi，再执行方法Mj。</p>
<p>有状态边有两种好处，一是使得我们可以把actor嵌入到无状态的任务图中，因为actor维护着自己的一个调用链和状态。二是，有状态边可以用来维护世系(lineage)信息，世系可以帮助Ray重建数据对象，包括remote function创建的或是actor method创建的。</p>
<h2 id="架构（Architecture）"><a href="#架构（Architecture）" class="headerlink" title="架构（Architecture）"></a>架构（Architecture）</h2><p>架构包括两层，应用层(Application Layer)和系统层(System Layer)。</p>
<h3 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h3><p><img src="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-02.jpg" alt=""><br>应用层包含三种进程，Driver，Worker，Actor。</p>
<p>Driver用来执行用户程序，即<code>python xx.py</code>产生的进程。</p>
<p>Worker用来执行task，task（remote function）可以由driver或者是其他worker调用，每个机器上运行<code>ray start</code>后会启动0个或多个Worker【待详述】。Worker是无状态的，由系统层指配task。<br>当一个remote函数声明的时候，函数会自动发布到所有worker。【待详述】</p>
<p>Actor是一个有状态的进程，当其方法被调用时执行，Actor一经启动在某个节点上，则负责执行所有该actor的方法调用。<br>Actor是有driver或者worker显式地初始化得到的，即采用<code>actor_name.remote()</code>的方式。</p>
<p><img src="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-03.jpg" alt="Ray架构与自底向上调度器示意图"></p>
<p>系统层而言，提供了三个组件，每个组件都具有水平可扩展性以及容错机制，来保证前述性能目标和容错目标。</p>
<p>三个组件分别是：全局控制状态(global control state)，分布式自底向上调度器(distributed bottom-up scheduler)，分布式对象存储(distributed object store)。</p>
<h3 id="系统层-Global-Control-State"><a href="#系统层-Global-Control-State" class="headerlink" title="系统层-Global Control State"></a>系统层-Global Control State</h3><p>全局控制状态（GCS）是一个中心化的存储，使用Redis实现，负责存储task描述，remote方法代码，计算图，对象的位置，以及每个调度事件。<br>将所用控制状态集中存储，有这么几个好处：<br>1）使得集群中其他组件、节点可以无状态。这样的话可以大大提升水平扩展的能力。<br>2）简化了容错。<br>3）方便对程序debug，profile。</p>
<p>当然，集中式存储带来的隐忧就是瓶颈问题，基于Redis，可以做分片(sharding)来缓解单点瓶颈。并且为每个分片提供热副本(hot replica)【是什么？】来容错。<br>鉴于在Ray中，每个task, object, method等都有一个唯一的伪随机ID与其一一对应，使得分片间能够更好地负载均衡。</p>
<h3 id="系统层-Distributed-Bottom-Up-Scheduler"><a href="#系统层-Distributed-Bottom-Up-Scheduler" class="headerlink" title="系统层-Distributed Bottom-Up Scheduler"></a>系统层-Distributed Bottom-Up Scheduler</h3><p>分布式自底向上调度器（distributed bottom-up scheduler），负责任务的调度。Ray启动时，会启动一个全局的调度器global scheduler，实现上是一个redis server，会在每个从节点上启动一个local scheduler，每个节点上提交的task率先提交给各自的local scheduler进行调度，如果local scheduler调度不了，则上推给global scheduler，进行集群全局范围的调度。<br>Ray这样设计的目标是调度可扩展性以及快速，低延迟的调度。这样设计带来的好处就是Ray调度任务非常之快。</p>
<p>那么Ray这样设计的灵感来自于哪里呢？</p>
<p>通常的分布式集群计算框架实现的都是中心化，集中式的调度，如Hadoop, Spark, CIEL, Dryad等。这种方式虽然简化了设计，但是扩展性不好。</p>
<p>提升调度扩展性有几种方式：<br>1）批量调度。调度器批量提交任务给worker节点，以摊销提交任务带来的固定开销。Drizzle框架实现的就是这种。<br>2）层次调度。即全局调度器(global scheduler)将任务图划分到各个节点的本地调度器(local scheduler)。Canary框架实现了这种调度。<br>3）并行调度。多个全局调度器同时进行任务调度。这是Sparrow框架所做的。</p>
<p>但是他们都有各自的缺陷。<br>批量调度仍然需要一个全局调度器来处理所有任务。<br>层次调度假设任务图是已知的，即假设任务图是静态的。<br>并行调度假设每个全局调度器调度独立的作业。</p>
<p>Ray希望做到的是高可扩展性，处理动态任务图，并且可能处理来自同一个作业的任务。</p>
<p>Ray的自底向上调度器类似层次调度，不同的是，一个节点生成的task首先提交到各自的local scheduler，由local scheduler进行调度。除非本地节点过载了，或者本地节点不能满足task的资源需求，或者task的输入不在本地节点等因素出现，否则本地节点可以完成调度。</p>
<p>其实最后一条，task的输入不再本地，仍有方式在本地调度，因为object store可以实现快速的数据对象转运。</p>
<p>看到这里，读者可能想问，Ray的local scheduler是怎样判断是否该调度到本地节点还是上推到global scheduler呢？</p>
<p>Ray是这样处理的，local scheduler会维护一个任务队列（task queue），每次调度任务时它会检查当前任务队列的长度，如果超过一定的阈值，那么认为本机过载了，不在调度当前任务而是将其转给上层全局调度器。</p>
<p>这个阈值为0，则调度为集中式的调度，全靠global scheduler负责。<br>这个阈值为无穷大，则调度为去中心化的分布式调度，所有任务都有本地节点负责。</p>
<p>在框架设计上，local scheduler每隔一段时间会发送心跳包给GCS，注意不是直接发送给global scheduler，心跳包中会包含local scheduler的负载信息，GCS收到以后记录此信息，转发给global scheduler。<br>当收到local scheduler转发来的任务时，global scheduler使用最新的负载信息，以及人物的输入数据对象的位置和大小，来决定将task分发到哪个节点去运行。</p>
<p>如果global scheduler成为了瓶颈，那么采用多个副本，local scheduler随机选择一个global scheduler去转发任务。</p>
<h3 id="系统层-Distributed-Object-Store"><a href="#系统层-Distributed-Object-Store" class="headerlink" title="系统层-Distributed Object Store"></a>系统层-Distributed Object Store</h3><p>remote函数（task）的输入和输出数据都存储在Distributed Object Store中。<br>调用一个函数时，其输入首先被隐式执行<code>ray.put</code>，存储object store中，其输出也会被放入object store中，函数返回一个object id为该输出数据的唯一id，调用<code>ray.get(object_id)</code>才可获得任务返回的实际数据。</p>
<p>同一个节点上使用共享内存(shared memory)来实现object store，这使得两个不同的worker进程或者driver和worker之间能够零拷贝(zero copy)地访问共同的数据。具体实现采用了Apache Arrow中的plasma store。<a href="http://arrow.apache.org/" target="_blank" rel="external">Apache Arrow</a>是一种跨平台的内存数据交换格式。可参看介绍<a href="https://www.cnblogs.com/smartloli/p/6367719.html" target="_blank" rel="external"></a>，<a href="http://www.infoq.com/cn/articles/apache-arrow/" target="_blank" rel="external"></a>等。</p>
<p>如果一个task，其输入不在本地，那么object store会把数据从所在地拷贝到本地，这样可以避免热数据带来的瓶颈，同时可以加快程序执行速度，因为直接在本地内存中操作。当然，数据的传送开销也是免不了的。这也将提升计算受限工作流的吞吐量，计算受限是许多AI应用共有的特征。</p>
<p>为了简化系统设计，简化容错，Ray像其它内存计算系统如Spark, Dryad一样，其操作的数据是不可变的(immutable)，即存储在object store中的数据不能改变，如RDD一般。</p>
<p>Ray同时也不支持分布式对象，如分布式大矩阵，当然可以通过在应用层自行实现（通过一系列的futures）。</p>
<p><strong>对象重建</strong></p>
<p>像Spark，CIEL一样，Ray根据世系来重建对象。除此之外，Ray还支持有状态操作算子(Actor)的重建。</p>
<p>要注意的是，如果世系中包含有状态边，则可能涉及到Actor的重新初始化，并且可能涉及到很长一条世系链的重放。对于某些应用，Ray为了减少Actor的重建时间，加入了checkpoint机制，从checkpoint进行恢复。</p>
<p>为了保证低延迟，如果plasma store满了以后，会通过LRU机制剔除陈旧的对象到磁盘。【到磁盘哪里？】<br>在Ray中，plasma store即object store挂载在Linux属于tmpfs文件系统的<code>/dev/shm</code>目录上，该目录不在磁盘上，而在内存里。已经存入<code>/dev/shm</code>中的对象不能被其他应用程序使用，但是<code>/dev/shm</code>没被使用的部分可被其他应用程序使用。<br><code>/dev/shm</code>区域的大小一般是总内存的1/2。即如果你的机器是64G内存，那么此区域只有32G可用，Ray会再保留一点余量，大概用于object store的空间只有26-27GB左右，也就是说，如果Ray处理的数据过大，大到object store都装不下或者在运行时需要频繁evict甚至evict掉其他必要数据的时候，往往程序就会崩溃。</p>
<center> <img src="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-04.jpg" alt="Ray执行任务示意简图1"><br><img src="https://blog-image-1256228880.cos.ap-beijing.myqcloud.com/ray-05.jpg" alt="Ray执行任务示意简图2"><br></center>

<h2 id="相关工作"><a href="#相关工作" class="headerlink" title="相关工作"></a>相关工作</h2><p>下表对相关工作与Ray的相似点与不同点做一总结。</p>
<table><tr><th></th><th>比较的系统框架</th><th>相似点</th><th>不同点</th></tr><tr><th rowspan="2">动态任务图</th><td>CIEL</td><td>动态任务图机制，futures抽象，通过世系容错</td><td>Ray还提供Actor抽象，并实现了全局控制面板，自底向上调度器和采用了内存对象存储而不是文件存储，扩展到Python语言</td></tr><tr><td>Dask</td><td>支持动态任务图，wait原语，futures抽象，Python语言</td><td>Dask是中心化调度方式，不提供actor抽象，不提供容错</td></tr><tr><th rowspan="3">数据流系统</th><td>Hadoop/Spark</td><td></td><td>Hadoop/Spark计算模型更加限定，实现了BSP执行模型，假设同一阶段的task执行同样的计算，并有着相似的执行时间。Ray还提供Actor抽象，并实现了全局控制面板和调度器。</td></tr><tr><td>Dryad</td><td></td><td>Dryad放松了Spark的假设，但是也没有实现动态计算图。Ray还提供Actor抽象，并实现了全局控制面板和调度器。</td></tr><tr><td>Naiad</td><td>对于一些工作流提升了可扩展性。</td><td>只支持静态计算图。</td></tr><tr><th rowspan="3">Actor系统</th><td>Orleans</td><td>提供虚拟actor-based抽象。</td><td>Orleans可以使actor的多个实例同时运行。需要显式checkpoint，提供at-least-once语义。而Ray提供exactly-once语义。[注]</td></tr><tr><td>Erlang</td><td>Actor抽象。</td><td>需显式处理容错。Erlang的全局状态存储不适合共享大对象。</td></tr><tr><td>C++ Actor Framework</td><td>Actor抽象。</td><td>需显式处理容错。不支持数据共享。</td></tr><tr><th rowspan="7">全局控制状态和调度</th><td>SDN</td><td>全局控制状态</td><td>Ray解耦了状态信息存储和逻辑实现（调度器），存储与计算可以独立扩展</td></tr><tr><td>Distributed File System，如GFS</td><td>全局控制状态</td><td>Ray解耦了状态信息存储和逻辑实现（调度器），存储与计算可以独立扩展</td></tr><tr><td>Distributed Frameworks (如MapReduce, BOOM)</td><td>全局控制状态</td><td>与BOOM相比，Ray解耦了状态信息存储和逻辑实现（调度器），存储与计算可以独立扩展</td></tr><tr><td>Resource Management (Omega)</td><td>全局共享状态</td><td>Ray增加了两层调度器来均衡负载，面向毫秒级别的任务调度</td></tr><tr><td>Sparrow</td><td>去中心化调度</td><td>各调度器自行其是，独立决策</td></tr><tr><td>Mesos</td><td>两级层次调度</td><td>顶层调度器可能成为瓶颈</td></tr><tr><td>Canary</td><td>去中心化调度</td><td>Canary每个调度器负责计算图的一部分，但不支持动态计算图</td></tr><tr><th rowspan="3">机器学习框架</th><td>Tensorflow</td><td></td><td>面向深度学习，对CPU、GPU资源利用很好，不支持更通用的计算工作流，Tensorflow Fold提供对动态计算图的一些支持，但仍无法全部支持执行时对任务执行进度，任务完成时间和错误的响应而编辑DAG图。支持底层消息传输和同步原语，但是过于底层使得用起来有点像MPI。</td></tr><tr><td>MXNet</td><td></td><td>同Tensorflow</td></tr><tr><td>OpenMPI</td><td>高性能</td><td>很难编程，需要显式处理异构和动态任务图，需要程序员显式处理容错</td></tr></table>

<p>[注] 实时计算/流式计算的三种语义：<br>At-most-once：每条记录最多只能被处理一次<br>At-least-once：每条记录最少要被处理一次<br>Exactly-once：每条记录有且仅被处理一次</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>蓬勃发展的AI应用对计算框架提出了一些挑战性的需求，为了应对这些需求，本文提出了Ray，实现了全局控制存储和自底向上的调度器，且实现了动态任务图。支持Actor编程和任务并行。这种编程灵活性对于强化学习RL应用尤其重要，因其具有诸多方面的异构性，如执行时间，资源等。Ray提供了一个灵活高性能且易于使用的框架来应对未来的AI应用。</p>
  
	</div>


    
	<!-- css -->
	<style type="text/css">
	    .center {
	        text-align: center;
	    }
	    .hidden {
	        display: none;
	    }
		.donate_bar a.btn_donate{
			display: inline-block;
			width: 82px;
			height: 82px;
			background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;
			_background: url("http://7xsl28.com1.z0.glb.clouddn.com/btn_reward.gif") no-repeat;

			<!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
			     因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
				 为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
				 嵌入其它博客时不一定要它们。 -->
			-webkit-transition: background 0s;
			-moz-transition: background 0s;
			-o-transition: background 0s;
			-ms-transition: background 0s;
			transition: background 0s;
			<!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束 -->
		}

		.donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
		.donate_bar .donate_txt {
			display: block;
			color: #9d9d9d;
			font: 14px/2 "Microsoft Yahei";
		}
		.bold{ font-weight: bold; }
	</style>
	<!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

	<!-- btn_donate & tips -->
	<div id="donate_board" class="donate_bar center">
	    <br>
	    ------------------------------------------------------------------------------------------------------------------------------
	    <br>
		<a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
		<span class="donate_txt">
			我要小额赞助，助作者写出更好的文章！
		</span>
			
		
	</div>
	<!-- /btn_donate & tips -->

	<!-- donate guide -->
    
	<div id="donate_guide" class="donate_bar center hidden">
        <br>
	    ------------------------------------------------------------------------------------------------------------------------------
	    <br>
	    
	    <div width="100%" align="center"><div name="dashmain" id="dash-main-id-87895f" class="dash-main-3 87895f-0.99"></div></div>
		<script type="text/javascript" charset="utf-8" src="http://www.dashangcloud.com/static/ds.js"></script>
		

		<a href="http://7xsl28.com1.z0.glb.clouddn.com/wechatpay.png" title="用微信扫一扫哦~" class="fancybox" rel="article0">
			<img src="http://7xsl28.com1.z0.glb.clouddn.com/wechatpay.png" title="微信打赏 Donate" height="190px" width="auto"/>
		</a>
        
        &nbsp;&nbsp;

		<a href="http://7xsl28.com1.z0.glb.clouddn.com/alipay.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
			<img src="http://7xsl28.com1.z0.glb.clouddn.com/alipay.jpg" title="支付宝打赏 Donate" height="190px" width="auto"/>
		</a>

		<span class="donate_txt">
			我要小额赞助，助作者写出更好的文章！
		</span>

	</div>
	<!-- /donate guide -->

	<!-- donate script -->
	<script type="text/javascript">
		document.getElementById('btn_donate').onclick = function() {
			$('#donate_board').addClass('hidden');
			$('#donate_guide').removeClass('hidden');
		}

		function donate_on_web(){
			$('#donate').submit();
        }

		var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
		}
	</script>
	<!-- /donate script -->
</div>
<!-- /Donate Module -->
   

		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  
  <span></span> <a href="/categories/大数据系统与技术-Big-Data/">大数据系统与技术 | Big Data</a>
  </div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Deep-Learning/">Deep Learning</a><a href="/tags/机器学习/">机器学习</a><a href="/tags/论文阅读/">论文阅读</a><a href="/tags/系统/">系统</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	<div class="share-jiathis">
	  
<div class="jiathis_style_24x24">
	<a class="jiathis_button_tsina"></a>
	<a class="jiathis_button_weixin"></a>
	<a class="jiathis_button_tqq"></a>
	<a class="jiathis_button_qzone"></a>
	<a class="jiathis_button_douban"></a>
	<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	<a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
     ralateuid:{"tsina":"husuche## e.g. 2176287895 Your weibo id,It will be used in share button."},hideMore:false}
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=2094149
2094149" charset="utf-8"></script>      

	 </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2018/03/15/caffeinstall.html" title="CentOS 7.x 安装Caffe GPU版本全过程">
  <strong>上一篇：</strong><br/>
  <span>
  CentOS 7.x 安装Caffe GPU版本全过程</span>
</a>
</div>


<div class="next">
<a href="/2018/03/11/optimizationAlgos.html"  title="神经网络一阶优化算法手记">
 <strong>下一篇：</strong><br/> 
 <span>神经网络一阶优化算法手记
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <aside class="clearfix">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#摘要（Abstract）"><span class="toc-number">1.</span> <span class="toc-text">摘要（Abstract）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#介绍（Introduction）"><span class="toc-number">2.</span> <span class="toc-text">介绍（Introduction）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Motivation-and-Requirements"><span class="toc-number">3.</span> <span class="toc-text">Motivation and Requirements</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编程模型和计算模型（Programming-and-Computation-Model）"><span class="toc-number">4.</span> <span class="toc-text">编程模型和计算模型（Programming and Computation Model）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#编程模型"><span class="toc-number">4.1.</span> <span class="toc-text">编程模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#计算模型"><span class="toc-number">4.2.</span> <span class="toc-text">计算模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#架构（Architecture）"><span class="toc-number">5.</span> <span class="toc-text">架构（Architecture）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#应用层"><span class="toc-number">5.1.</span> <span class="toc-text">应用层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统层-Global-Control-State"><span class="toc-number">5.2.</span> <span class="toc-text">系统层-Global Control State</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统层-Distributed-Bottom-Up-Scheduler"><span class="toc-number">5.3.</span> <span class="toc-text">系统层-Distributed Bottom-Up Scheduler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#系统层-Distributed-Object-Store"><span class="toc-number">5.4.</span> <span class="toc-text">系统层-Distributed Object Store</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#相关工作"><span class="toc-number">6.</span> <span class="toc-text">相关工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">7.</span> <span class="toc-text">总结</span></a></li></ol>
 
 </aside>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="about">
    <p class="asidetitle">Short bio</p>
    <div class="clearfix">
        <!-- <img src="http://7xsl28.com1.z0.glb.clouddn.com/niuzai.jpg" height="74px" width="74px" id="about-image" alt> -->
        <span style="font-size: medium; font-family: Calibri Light, Open Sans, Microsoft YaHei Light">
        whatbeg.com is written by Qiu Hu. He is living in Nanjing, P.R. China.
        <br>
        You can contact Qiu Hu with email.
        <br>
        Just enjoy your reading here!
        <br>
        Comments are always welcome:)
        <br>
        Some interesting non-technical articles can be seen in his WeChat official account: 
        </span>
        <br>
        <img src="https://gitee.com/whyseek/blogimages/raw/master/qrcode.jpg" height="124px" width="124px" id="qrcode" alt>
    </div>
</div>


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/大数据系统与技术-Big-Data/" title="大数据系统与技术 | Big Data">大数据系统与技术 | Big Data<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/成长之路-Biography/" title="成长之路 | Biography">成长之路 | Biography<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据科学-Data-Science/" title="数据科学 | Data Science">数据科学 | Data Science<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/机器学习-Mac-Learning/" title="机器学习 | Mac.Learning">机器学习 | Mac.Learning<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/深度学习-Deep-Learning/" title="深度学习 | Deep Learning">深度学习 | Deep Learning<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法-Algorithm/" title="算法 | Algorithm">算法 | Algorithm<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程语言-Program-Lang/" title="编程语言 | Program Lang.">编程语言 | Program Lang.<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/计算机相关-CS-Related/" title="计算机相关 | CS.Related">计算机相关 | CS.Related<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/译文-Translation/" title="译文 | Translation">译文 | Translation<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书-Reading/" title="读书 | Reading">读书 | Reading<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/错误解决与优化-Err-Opt/" title="错误解决与优化 | Err&amp;Opt">错误解决与优化 | Err&amp;Opt<sup>13</sup></a></li>
		  
		
		  
			<li><a href="/categories/随笔-Essays/" title="随笔 | Essays">随笔 | Essays<sup>7</sup></a></li>
		  
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">归档</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">九月 2016</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">六月 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">23</span></li></ul>
  </div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/CS/" style="font-size: 17px;">CS</a> <a href="/tags/Deep-Learning/" style="font-size: 17px;">Deep Learning</a> <a href="/tags/GPU/" style="font-size: 10px;">GPU</a> <a href="/tags/Git/" style="font-size: 11px;">Git</a> <a href="/tags/Hadoop/" style="font-size: 14px;">Hadoop</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/Latex/" style="font-size: 11px;">Latex</a> <a href="/tags/Linux/" style="font-size: 13px;">Linux</a> <a href="/tags/Python/" style="font-size: 19px;">Python</a> <a href="/tags/Scala/" style="font-size: 10px;">Scala</a> <a href="/tags/Spark/" style="font-size: 12px;">Spark</a> <a href="/tags/Summary/" style="font-size: 16px;">Summary</a> <a href="/tags/TensorFlow/" style="font-size: 12px;">TensorFlow</a> <a href="/tags/Web/" style="font-size: 12px;">Web</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/三国/" style="font-size: 10px;">三国</a> <a href="/tags/人文社科/" style="font-size: 10px;">人文社科</a> <a href="/tags/优化/" style="font-size: 10px;">优化</a> <a href="/tags/吃喝玩乐/" style="font-size: 10px;">吃喝玩乐</a> <a href="/tags/大数据/" style="font-size: 16px;">大数据</a> <a href="/tags/工具使用/" style="font-size: 10px;">工具使用</a> <a href="/tags/影视/" style="font-size: 11px;">影视</a> <a href="/tags/数据分析/" style="font-size: 16px;">数据分析</a> <a href="/tags/机器学习/" style="font-size: 20px;">机器学习</a> <a href="/tags/深度学习/" style="font-size: 18px;">深度学习</a> <a href="/tags/算法/" style="font-size: 13px;">算法</a> <a href="/tags/系统/" style="font-size: 10px;">系统</a> <a href="/tags/论文阅读/" style="font-size: 12px;">论文阅读</a> <a href="/tags/译文/" style="font-size: 12px;">译文</a> <a href="/tags/读书/" style="font-size: 19px;">读书</a> <a href="/tags/错误解决/" style="font-size: 12px;">错误解决</a> <a href="/tags/随笔/" style="font-size: 15px;">随笔</a>
    </div>
  </div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www.cnblogs.com/whatbeg/" target="_blank" title="Old Blog">Old Blog</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/whatbeg" target="_blank" title="My Github">My Github</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.matrix67.com/blog/" target="_blank" title="Matrix67">Matrix67</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.liaoxuefeng.com/" target="_blank" title="廖雪峰">廖雪峰</a>
            
          </li>
        
          <li>
            
            	<a href="http://www.ruanyifeng.com/blog/" target="_blank" title="阮一峰">阮一峰</a>
            
          </li>
        
          <li>
            
            	<a href="http://mindhacks.cn/" target="_blank" title="刘未鹏">刘未鹏</a>
            
          </li>
        
          <li>
            
            	<a href="http://machinelearningmastery.com/blog/" target="_blank" title="ML MYSTERY">ML MYSTERY</a>
            
          </li>
        
          <li>
            
            	<a href="http://freemind.pluskid.org/" target="_blank" title="Free Mind">Free Mind</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.csdn.net/zouxy09/" target="_blank" title="zouxy机器学习">zouxy机器学习</a>
            
          </li>
        
          <li>
            
            	<a href="http://coolshell.cn" target="_blank" title="酷壳">酷壳</a>
            
          </li>
        
    </ul>
</div>

  <table height=30 cellSpacing=0 cellPadding=0 width=180 border=0>
<form action="http://www.sogou.com/web" target="_blank">
<tr style='font-size:12px;color:#000000'>
<td align="center" width=100><input type="text" name="query" size=14 style='BORDER-RIGHT: #999 1px solid; BORDER-TOP: #999 1px solid; BORDER-LEFT: #999	1px	solid; BORDER-BOTTOM: #999 1px solid; HEIGHT: 19px; BACKGROUND-COLOR: #fff'>
<input type="hidden" name="insite" value="whatbeg.com">
<input type="hidden" name="insite2" value="whatbeg.com"></td>
<td align="left" width=45><input type="submit" name="sogou_submit" value="搜索">
</td></tr></form>
</table>



  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="rsspart">
	<a href="http://eepurl.com/cHO5An" target="_blank" title="email">Email 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
        

	    
		
				<div class="cc-license">
          <a href="http://creativecommons.org/licenses/by-nc-nd/4.0" class="cc-opacity" target="_blank">
            <img src="/img/cc-by-nc-nd.svg" alt="Creative Commons" />
          </a>
        </div>
    

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016-2019 
		
		<a href="/about" target="_blank" title="whatbeg">whatbeg</a>
		
		<br>
		<span class="post-count">Total words: <span style="color:orange">329.1k</span></span>
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">
        &nbsp;&nbsp;Total visits:&nbsp;<span style="color:orange" id="busuanzi_value_site_pv"></span>
        </span>
        <span id="busuanzi_container_site_uv">
        &nbsp;&nbsp;You are Visitor No.<span style="color:orange" id="busuanzi_value_site_uv"></span>
        </span>
        </br>
		</p>
		
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    $('#toc.toc-aside').css('display', 'block').addClass('fadeIn');  //侧边栏显示文章目录
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');   //侧边栏显示widget
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>





<script type="text/javascript">

var disqus_shortname = 'whatbeg';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1258390595'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1258390595%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->
<script>
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
  </body>
</html>


